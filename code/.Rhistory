setwd("code/")
options(stringsAsFactors = FALSE)
'%!in%' <- function(x,y)!('%in%'(x,y))
#more than plots - get sankey data.
library(quanteda)
library(stringr)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora", full.names = TRUE)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora_6_years", full.names = TRUE)
corp_files <- list.files("../data/work/netowrking_archives/corpora_titles", full.names = TRUE)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora", full.names = TRUE)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora_6_years", full.names = TRUE)
corp_files <- list.files("../../ESTC_SNA_data_creation/data/work/netowrking_archives/corpora_titles", full.names = TRUE)
eras <- unique(str_extract(corp_files, "\\d\\d\\d\\d-\\d\\d\\d\\d"))
eras
i_era_dfm<-1
cat("\n", eras[i_era_dfm], "\n")
temp_files <- corp_files[grep(eras[i_era_dfm], corp_files)]
temp_files
#load and combine corps
for(i_corp in 1:length(temp_files)) {
temp_corp <- readRDS(temp_files[i_corp])
if(i_corp == 1) {
docvars(temp_corp, "Community") <- paste0("Community_", i_corp)
docnames(temp_corp) <- paste0(i_corp, "_", docnames(temp_corp))
temp_com_corp <- temp_corp
} else {
docvars(temp_corp, "Community") <- paste0("Community_", i_corp)
docnames(temp_corp) <- paste0(i_corp, "_", docnames(temp_corp))
temp_com_corp <- temp_com_corp + temp_corp
}
}
docnames(temp_corp)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora", full.names = TRUE)
#corp_files <- list.files("../../data/work/netowrking_archives/corpora_6_years", full.names = TRUE)
corp_files <- list.files("../../ESTC_SNA_data_creation/data/work/netowrking_archives/corpora_titles", full.names = TRUE)
length(eras)
for(i_era_dfm in 1:length(eras)) {
cat("\n", eras[i_era_dfm], "\n")
temp_files <- corp_files[grep(eras[i_era_dfm], corp_files)]
#load and combine corps
for(i_corp in 1:length(temp_files)) {
temp_corp <- readRDS(temp_files[i_corp])
if(i_corp == 1) {
docvars(temp_corp, "Community") <- paste0("Community_", i_corp)
docnames(temp_corp) <- paste0(i_corp, "_", docnames(temp_corp))
temp_com_corp <- temp_corp
} else {
docvars(temp_corp, "Community") <- paste0("Community_", i_corp)
docnames(temp_corp) <- paste0(i_corp, "_", docnames(temp_corp))
temp_com_corp <- temp_com_corp + temp_corp
}
rm(temp_corp)
}
if(i_era_dfm == 1) {
docvars(temp_com_corp, "Era") <- eras[i_era_dfm]
docnames(temp_com_corp) <- paste0(eras[i_era_dfm], "_", docnames(temp_com_corp))
total_dfm <- temp_com_corp
} else {
docvars(temp_com_corp, "Era") <- eras[i_era_dfm]
docnames(temp_com_corp) <- paste0(eras[i_era_dfm], "_", docnames(temp_com_corp))
total_dfm <- total_dfm + temp_com_corp
}
rm(temp_com_corp)
gc()
}
total_dfm <- dfm(total_dfm, remove_punct = TRUE, verbose = TRUE)
#saveRDS(total_era_dfm, file = paste0("../../data/work/netowrking_archives/com_dfm/com_dfm_", eras[i_era_dfm], ".rds"))
saveRDS(total_dfm, file = paste0("../../ESTC_SNA_data_creation/data/work/netowrking_archives/total_era_dfm.rds"))
